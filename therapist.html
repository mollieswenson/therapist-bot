<!DOCTYPE HTML>
<html>
<head>
<style>
p {
 line-height: 50%;
}
</style>
</head>
<body onload="initialize()">
<h1>Eliza</h1>
<p>Write here: <input id="textbox" size="70"/></p>
<p><button onclick="submitLine()">Submit</button></p>
<div id="conversation"></div>
<script>
var therapySession;

//add logic to use this 
var emptyResponses = [
	"xxxx.",
	"xx.",
	"xxxxxx?",
	"xxxx.",
	"xxxx...",
	"x."];

var genericResponses = [
	"Uh-huh.",
	"Go on.",
	"Why do you say that?",
	"That's very interesting.",
	"Fascinating...",
	"Keep talking."];
 
const questionResponses = [
	"Why do you ask that?",
	"What do <em>you</em> think?",
	"That's an interesting question.",
	"How long have you wanted to know that?",
	"That depends on who you ask."];
 
const exclamationResponses = [
	"Please calm down.",
	"No need to get so excited.",
	"You sound very passionate about that.",
	"Would you care to restate that in a more neutral tone?"];
 
const povSwitches = {
	"I": "you",
	"i": "you",
	"me": "you",
	"myself": "yourself",
	"am": "are",
	"my": "your",
	"My": "your",
	"I'm": "you're",
	"I'd": "you'd",
	"I'll": "you'll",
	"i'm": "you're",
	"i'd": "you'd",
	"i'll": "you'll"
}
const questionStarts = [
	"Why do you say that",
	"How is it that",
	"Can you tell me more about how",
	"And why is it that",
	"Can you explain why you say that"];

function initialize() {
	therapySession = "<p> I am the psychotherapist. What is your problem? </p>";
	conversation.innerHTML = therapySession;
}

function submitLine() {
	var patientLine = textbox.value;
	therapySession += "<p> <em>" + patientLine + "</em> </p>";
 	var therapistLine;
	
	if (patientLine == "") {
	therapySession += "Please talk to me";
	}
	
	if (lastChar(patientLine) == "?") {
		therapistLine = randomElement(questionResponses);
	} else if (lastChar(patientLine) == "!") {
		therapistLine = randomElement(exclamationResponses);
	} else {
		therapistLine = createQuestion(patientLine);
	}
	// Still no good response, so use a basic response. 
	if (therapistLine == null) {
		therapistLine = randomElement(genericResponses);
	} 
	therapySession += "<p>" + therapistLine + "</p>";
	conversation.innerHTML = therapySession;
}

function randomElement(myArray) {
	var index = Math.floor(Math.random() * myArray.length);
	return myArray[index];
}

function lastChar(myString) {
	return myString.substring(myString.length - 1);
}

function createQuestion(patientLine) {
	if (patientLine.toLowerCase().indexOf("you") != -1) {
		return null;
	}
	if (lastChar(patientLine) == ".") {
		patientLine = patientLine.substring(0, patientLine.length - 1);
	}		
	var modifiedLine = " " + patientLine + " ";
	var found = false;
	for (var property in povSwitches) {
		if (povSwitches.hasOwnProperty(property)) {
			var modifiedProperty = " " + property + " ";
		if (modifiedLine.indexOf(modifiedProperty) != -1) {
			modifiedLine = modifiedLine.replace(modifiedProperty,
				" " + povSwitches[property] + " ");
			found = true;
		}
		}
	}
	if (found) {
		modifiedLine = modifiedLine.substring(0, modifiedLine.length - 1);
		return randomElement(questionStarts) + " " + modifiedLine + "?";
	} 
	return null;
}
</script>
</body>
</html>